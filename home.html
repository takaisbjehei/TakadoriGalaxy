<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Modern Chat UI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    body { background: linear-gradient(120deg, #f5f6fa 0%, #e0e7ff 100%); }
    .chat-bubble { border-radius: 1.2rem; }
    .chat-bubble.sent { background: #6c63ff; color: #fff; }
    .chat-bubble.received { background: #fff; color: #222; border: 1px solid #e5e7eb; }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen">
  <div class="flex flex-col md:flex-row gap-8 bg-transparent">
    <!-- Chat List (Sidebar) -->
    <div class="w-[350px] bg-white rounded-3xl shadow-xl p-6 flex flex-col">
      <div class="flex items-center justify-between mb-6">
        <div>
          <div class="text-gray-500 text-sm">Hello,</div>
          <div class="font-bold text-2xl" id="sidebarUserName">Johan</div>
        </div>
        <div class="flex gap-2">
          <button class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-500"><i class="fas fa-search"></i></button>
          <button class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-500"><i class="fas fa-plus"></i></button>
        </div>
      </div>
      <div class="flex mb-4 gap-2">
        <button class="flex-1 py-2 rounded-full bg-indigo-100 text-indigo-600 font-semibold">All Chats</button>
        <button class="flex-1 py-2 rounded-full text-gray-400 font-semibold">Groups</button>
        <button class="flex-1 py-2 rounded-full text-gray-400 font-semibold">Contacts</button>
      </div>
      <div id="chatList" class="flex-1 overflow-y-auto scrollbar-hide">
        <!-- Chat items will be injected here -->
        <!-- Example static chat item: -->
        <!--
        <div class="flex items-center gap-3 py-3 px-2 rounded-xl hover:bg-indigo-50 cursor-pointer mb-1">
          <img src="https://randomuser.me/api/portraits/men/32.jpg" class="w-12 h-12 rounded-full"/>
          <div class="flex-1">
            <div class="font-semibold">Larry Mashigo</div>
            <div class="text-xs text-gray-400 truncate">UI Brief.docx</div>
          </div>
          <div class="text-xs text-gray-400">09:42 AM</div>
        </div>
        -->
      </div>
      <button class="w-14 h-14 rounded-full bg-indigo-500 text-white flex items-center justify-center text-2xl mt-4 self-end shadow-lg hover:bg-indigo-600 transition">
        <i class="fas fa-comment-alt"></i>
      </button>
    </div>

    <!-- Chat Window -->
    <div class="w-[350px] bg-indigo-500 rounded-3xl shadow-xl flex flex-col text-white relative">
      <!-- Chat header -->
      <div class="flex items-center gap-3 p-5 rounded-t-3xl bg-indigo-600">
        <button id="backBtn" class="md:hidden text-white text-xl"><i class="fas fa-arrow-left"></i></button>
        <img id="chatAvatar" src="https://randomuser.me/api/portraits/men/32.jpg" class="w-10 h-10 rounded-full border-2 border-white"/>
        <div>
          <div class="font-semibold" id="chatUserName">Larry Mashigo</div>
          <div class="text-xs text-indigo-200" id="chatUserStatus">online</div>
        </div>
        <div class="ml-auto flex gap-2">
          <button class="w-8 h-8 rounded-full bg-indigo-400 bg-opacity-20 flex items-center justify-center"><i class="fas fa-phone"></i></button>
          <button class="w-8 h-8 rounded-full bg-indigo-400 bg-opacity-20 flex items-center justify-center"><i class="fas fa-video"></i></button>
        </div>
      </div>
      <!-- Messages -->
      <div id="messagesContainer" class="flex-1 overflow-y-auto scrollbar-hide p-5 flex flex-col gap-2">
        <!-- Example messages -->
        <!--
        <div class="chat-bubble sent self-end px-5 py-3 mb-2">Hey ðŸ‘‹</div>
        <div class="chat-bubble received self-start px-5 py-3 mb-2">Hello!</div>
        -->
      </div>
      <!-- Message input -->
      <form id="messageForm" class="flex items-center gap-2 p-4 rounded-b-3xl bg-indigo-600">
        <input id="messageInput" type="text" placeholder="Type a message..." class="flex-1 px-4 py-3 rounded-full bg-white text-gray-800 focus:outline-none"/>
        <button type="submit" class="w-10 h-10 rounded-full bg-white text-indigo-500 flex items-center justify-center text-xl hover:bg-indigo-100 transition"><i class="fas fa-paper-plane"></i></button>
      </form>
    </div>
  </div>

  <script>
    // Supabase setup
    const supabaseUrl = 'https://vmronlbzksuiikspvlvz.supabase.co';
    const supabaseKey = 'YOUR_SUPABASE_KEY';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    // State
    let currentUser = { id: 'user1', username: 'Johan', avatar: 'https://randomuser.me/api/portraits/men/50.jpg' }; // Demo user, replace with Supabase auth
    let chatList = []; // [{chat_id, user: {id, username, avatar, status}, last_message, last_time}]
    let selectedChat = null;

    // DOM
    const sidebarUserName = document.getElementById('sidebarUserName');
    const chatListDiv = document.getElementById('chatList');
    const chatUserName = document.getElementById('chatUserName');
    const chatAvatar = document.getElementById('chatAvatar');
    const chatUserStatus = document.getElementById('chatUserStatus');
    const messagesContainer = document.getElementById('messagesContainer');
    const messageInput = document.getElementById('messageInput');
    const messageForm = document.getElementById('messageForm');

    // Demo data for UI (replace with Supabase queries)
    chatList = [
      {
        chat_id: 1,
        user: { id: 'user2', username: 'Larry Mashigo', avatar: 'https://randomuser.me/api/portraits/men/32.jpg', status: 'online' },
        last_message: 'UI Brief.docx',
        last_time: '09:42 AM'
      },
      {
        chat_id: 2,
        user: { id: 'user3', username: 'Natalie Nora', avatar: 'https://randomuser.me/api/portraits/women/44.jpg', status: 'offline' },
        last_message: 'Thanks!',
        last_time: '08:10 AM'
      }
    ];
    let chatMessages = {
      1: [
        { sender: 'user2', content: 'Hey ðŸ‘‹', time: '09:40 AM' },
        { sender: 'user1', content: 'Hello!', time: '09:41 AM' },
        { sender: 'user2', content: 'Are you available for a new UI Project', time: '09:41 AM' },
        { sender: 'user1', content: 'yes, have some space for the new task', time: '09:41 AM' },
        { sender: 'user2', content: 'Cool, should I share the details now?', time: '09:41 AM' },
        { sender: 'user1', content: 'Yes Sure, please', time: '09:41 AM' },
        { sender: 'user2', content: 'Great, here is the SOW of the Project', time: '09:42 AM' },
        { sender: 'user2', content: 'UI Brief.docx', time: '09:42 AM' },
        { sender: 'user1', content: 'Ok. Let me check', time: '09:42 AM' }
      ]
    };

    // Render chat list
    function renderChatList() {
      chatListDiv.innerHTML = '';
      chatList.forEach(chat => {
        const div = document.createElement('div');
        div.className = 'flex items-center gap-3 py-3 px-2 rounded-xl hover:bg-indigo-50 cursor-pointer mb-1' + (selectedChat && selectedChat.chat_id === chat.chat_id ? ' bg-indigo-100' : '');
        div.onclick = () => selectChat(chat);
        div.innerHTML = `
          <img src="${chat.user.avatar}" class="w-12 h-12 rounded-full"/>
          <div class="flex-1">
            <div class="font-semibold">${chat.user.username}</div>
            <div class="text-xs text-gray-400 truncate">${chat.last_message}</div>
          </div>
          <div class="text-xs text-gray-400">${chat.last_time}</div>
        `;
        chatListDiv.appendChild(div);
      });
    }

    // Render messages
    function renderMessages(chat_id) {
      messagesContainer.innerHTML = '';
      (chatMessages[chat_id] || []).forEach(msg => {
        const isSelf = msg.sender === currentUser.id;
        const div = document.createElement('div');
        div.className = 'chat-bubble px-5 py-3 mb-2 ' + (isSelf ? 'sent self-end' : 'received self-start');
        div.textContent = msg.content;
        messagesContainer.appendChild(div);
      });
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    // Select chat
    function selectChat(chat) {
      selectedChat = chat;
      chatUserName.textContent = chat.user.username;
      chatAvatar.src = chat.user.avatar;
      chatUserStatus.textContent = chat.user.status;
      renderChatList();
      renderMessages(chat.chat_id);
    }

    // Send message (demo, replace with Supabase insert)
    messageForm.onsubmit = (e) => {
      e.preventDefault();
      if (!selectedChat || !messageInput.value.trim()) return;
      if (!chatMessages[selectedChat.chat_id]) chatMessages[selectedChat.chat_id] = [];
      chatMessages[selectedChat.chat_id].push({
        sender: currentUser.id,
        content: messageInput.value.trim(),
        time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
      });
      messageInput.value = '';
      renderMessages(selectedChat.chat_id);
    };

    // Init
    sidebarUserName.textContent = currentUser.username;
    renderChatList();
    selectChat(chatList[0]); // Select first chat by default

    // --- Supabase Integration (for real app) ---
    // 1. On load, fetch user's chat list (not all users!).
    // 2. When user starts a new chat, add to chatList.
    // 3. Fetch/send messages per chat using Supabase.
    // 4. Only show users in chatList (not all users).
  </script>
</body>
</html>
