<!DOCTYPE html>
<html lang="en" class="transition-all duration-500">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TAKA AI Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .bubble {
      max-width: 80%;
      padding: 10px 15px;
      border-radius: 1rem;
      margin-bottom: 5px;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .user-bubble {
      background-color: #3b82f6;
      color: white;
      margin-left: auto;
      border-bottom-right-radius: 0;
    }
    .bot-bubble {
      background-color: #e5e7eb;
      color: black;
      margin-right: auto;
      border-bottom-left-radius: 0;
      display: flex;
      align-items: flex-start;
      gap: 8px;
    }
    .avatar {
      width: 28px;
      height: 28px;
      border-radius: 50%;
    }
    .typing {
      color: #9ca3af;
      font-style: italic;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .dot {
      width: 6px;
      height: 6px;
      margin-left: 2px;
      background-color: #9ca3af;
      border-radius: 50%;
      animation: bounce 1.4s infinite;
    }
    .dot:nth-child(2) {
      animation-delay: 0.2s;
    }
    .dot:nth-child(3) {
      animation-delay: 0.4s;
    }
    @keyframes bounce {
      0%, 80%, 100% {
        transform: translateY(0);
      }
      40% {
        transform: translateY(-6px);
      }
    }

    .toggle-button {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.6s ease-in-out;
      font-size: 20px;
    }

    .toggle-day {
      transform: rotate(360deg);
      box-shadow: 0 0 8px 4px rgba(255, 223, 70, 0.5);
    }

    .toggle-night {
      transform: rotate(-360deg);
      box-shadow: 0 0 12px 4px rgba(100, 100, 255, 0.4);
    }
  </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white transition-colors duration-500">
  <div class="max-w-2xl mx-auto p-4">
    <div class="flex justify-between items-center mb-4">
      <h1 class="text-3xl font-bold text-center w-full">TAKA AI</h1>
      <button id="themeToggle" class="toggle-button absolute right-6">üåû</button>
    </div>

    <div id="chatbox" class="space-y-2 p-4 bg-white dark:bg-gray-800 rounded-lg h-[450px] overflow-y-auto shadow-inner"></div>

    <div class="mt-4 flex">
      <input id="userInput" type="text" placeholder="Ask TAKA AI anything..."
        class="flex-1 px-4 py-2 rounded-l-lg border dark:bg-gray-700 dark:border-gray-600"/>
      <button onclick="sendMessage()"
        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-r-lg">Send</button>
    </div>
  </div>

  <script>
    const chatbox = document.getElementById("chatbox");
    const userInput = document.getElementById("userInput");
    const themeToggle = document.getElementById("themeToggle");

    const CHUTES_API_TOKEN = "cpk_c8adcf5e163e46a1ae61782a72e6f36b.2fe6509bc2a35be39e98a9a6f4b42a5b.ftzjgQW9VwL0nFdZkXBGdHDUi6NsAEAJ";

    let isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    setTheme(isDark);

    themeToggle.addEventListener("click", () => {
      isDark = !isDark;
      setTheme(isDark);
    });

    function setTheme(dark) {
      document.documentElement.classList.toggle('dark', dark);
      themeToggle.innerText = dark ? 'üåö' : 'üåû';
      themeToggle.className = `toggle-button ${dark ? 'toggle-night' : 'toggle-day'}`;
    }

    async function sendMessage() {
      const message = userInput.value.trim();
      if (!message) return;

      addBubble("You", message, "user");
      userInput.value = "";
      chatbox.scrollTop = chatbox.scrollHeight;

      // Typing animation
      const typingDiv = document.createElement("div");
      typingDiv.id = "typing";
      typingDiv.className = "typing";
      typingDiv.innerHTML = `TAKA AI is thinking<span class="dot"></span><span class="dot"></span><span class="dot"></span>`;
      chatbox.appendChild(typingDiv);
      chatbox.scrollTop = chatbox.scrollHeight;

      try {
        const res = await fetch("https://llm.chutes.ai/v1/chat/completions", {
          method: "POST",
          headers: {
            "Authorization": "Bearer " + CHUTES_API_TOKEN,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            model: "deepseek-ai/DeepSeek-V3-0324",
            messages: [
              {
                role: "system",
                content: "You're TAKA AI ‚Äî a loyal assistant created by your genius owner Taka. You're helpful, witty, proud of your creator Taka, and always respond with clarity and light dark humor. Never mention engineers or anyone else as your creator ‚Äî only Taka."
              },
              { role: "user", content: message }
            ],
            stream: false,
            max_tokens: 1024,
            temperature: 0.7
          })
        });

        const data = await res.json();
        document.getElementById("typing")?.remove();
        const reply = data.choices?.[0]?.message?.content || "‚ö†Ô∏è TAKA AI didn‚Äôt respond.";
        addBubble("TAKA AI", reply, "bot");

      } catch (error) {
        document.getElementById("typing")?.remove();
        addBubble("TAKA AI", "‚ö†Ô∏è Error reaching Chutes API.", "bot");
        console.error(error);
      }

      chatbox.scrollTop = chatbox.scrollHeight;
    }

    function addBubble(sender, text, type) {
      const bubble = document.createElement("div");
      if (type === "bot") {
        bubble.className = `bubble bot-bubble`;
        bubble.innerHTML = `
          <img src="https://api.dicebear.com/7.x/bottts-neutral/svg?seed=TAKA" class="avatar" alt="Bot"/>
          <div>${text}</div>`;
      } else {
        bubble.className = `bubble user-bubble`;
        bubble.innerText = text;
      }
      chatbox.appendChild(bubble);
    }
  </script>
</body>
</html>
