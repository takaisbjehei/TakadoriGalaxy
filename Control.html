<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TAKA AI Control Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    #aiOutput, #imageOutput {
      white-space: pre-wrap;
      word-wrap: break-word;
      max-height: 300px;
      overflow-y: auto;
    }
  </style>
</head>
<body class="bg-gray-900 text-white p-4">
  <h1 class="text-3xl font-bold mb-6 text-center">TAKA AI Control Panel</h1>  <div id="adminContent" style="display:none;" class="max-w-4xl mx-auto bg-gray-800 p-6 rounded-lg shadow-lg">
    <div class="flex space-x-4 mb-6">
      <button id="textTabBtn" class="px-4 py-2 bg-blue-700 rounded">Text AI</button>
      <button id="imageTabBtn" class="px-4 py-2 bg-purple-700 rounded">Image Generator</button>
    </div><!-- Text AI Tab -->
<div id="textTab" class="tabContent">
  <h2 class="text-xl font-semibold mb-4 border-b border-gray-700 pb-2">Run a Text AI Mode</h2>
  <select id="selectModeToUse" class="w-full p-2 mb-3 rounded bg-gray-800 border border-gray-600"></select>
  <textarea id="aiInput" placeholder="Your prompt..." class="w-full p-2 mb-3 rounded bg-gray-800 border border-gray-600 h-24 resize-y"></textarea>
  <button id="runAiBtn" class="w-full bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded font-semibold">Run AI</button>
  <div class="mt-4">
    <label class="block text-sm font-medium text-gray-300 mb-1">AI Response:</label>
    <div id="aiOutput" class="p-3 rounded bg-gray-800 border border-gray-600 text-gray-300 min-h-[80px]">AI Response will appear here...</div>
  </div>
</div>

<!-- Image Generator Tab -->
<div id="imageTab" class="tabContent hidden">
  <h2 class="text-xl font-semibold mb-4 border-b border-gray-700 pb-2">Generate an Image</h2>
  <textarea id="imagePrompt" placeholder="Describe the image..." class="w-full p-2 mb-3 rounded bg-gray-800 border border-gray-600 h-24 resize-y"></textarea>
  <button id="generateImageBtn" class="w-full bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded font-semibold">Generate Image</button>
  <div class="mt-4">
    <label class="block text-sm font-medium text-gray-300 mb-1">Generated Image:</label>
    <div id="imageOutput" class="p-3 rounded bg-gray-800 border border-gray-600 text-gray-300 min-h-[80px] flex justify-center items-center">
      <img id="generatedImage" class="max-w-full max-h-96 rounded-lg" />
    </div>
  </div>
</div>

  </div>  <div id="accessDenied" class="hidden text-center mt-10 p-6 rounded-lg bg-red-900 text-red-300 border border-red-700 text-xl font-bold">ðŸš« Access Denied. Admins only.</div>  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const supabase = createClient(
      "https://vmronlbzksuiikspvlvz.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZtcm9ubGJ6a3N1aWlrc3B2bHZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk5ODMwNTcsImV4cCI6MjA2NTU1OTA1N30.WMKbpJn1aavkwQDmsYq_-4EMSLL9tc4LexpmRSCsmSM"
    );

    const selectModeToUse = document.getElementById('selectModeToUse');
    const aiInput = document.getElementById('aiInput');
    const runAiBtn = document.getElementById('runAiBtn');
    const aiOutput = document.getElementById('aiOutput');
    const imagePrompt = document.getElementById('imagePrompt');
    const generateImageBtn = document.getElementById('generateImageBtn');
    const generatedImage = document.getElementById('generatedImage');

    const textTab = document.getElementById("textTab");
    const imageTab = document.getElementById("imageTab");
    const textTabBtn = document.getElementById("textTabBtn");
    const imageTabBtn = document.getElementById("imageTabBtn");

    textTabBtn.onclick = () => {
      textTab.classList.remove("hidden");
      imageTab.classList.add("hidden");
    };
    imageTabBtn.onclick = () => {
      imageTab.classList.remove("hidden");
      textTab.classList.add("hidden");
    };

    async function checkAuthAndLoadModes() {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        alert("You are not logged in.");
        location.href = "/login.html";
        return;
      }
      const { data: adminCheck } = await supabase.from("admins").select("*").eq("user_id", user.id).maybeSingle();
      if (!adminCheck) {
        document.getElementById("accessDenied").classList.remove("hidden");
        return;
      }
      document.getElementById("adminContent").style.display = "block";
      const { data: modes } = await supabase.from("modes").select("*").eq("enabled", true);
      selectModeToUse.innerHTML = '<option value="">-- Select Mode --</option>';
      modes.forEach(m => {
        const opt = document.createElement("option");
        opt.value = JSON.stringify(m);
        opt.textContent = `${m.name} (${m.model})`;
        selectModeToUse.appendChild(opt);
      });
    }

    runAiBtn.onclick = async () => {
      aiOutput.textContent = "Thinking...";
      const selected = selectModeToUse.value;
      const prompt = aiInput.value.trim();
      if (!selected || !prompt) return aiOutput.textContent = "Please select a mode and enter a prompt.";

      const mode = JSON.parse(selected);

      try {
        const res = await fetch("https://llm.chutes.ai/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer cpk_c8adcf5e163e46a1ae61782a72e6f36b.2fe6509bc2a35be39e98a9a6f4b42a5b.ftzjgQW9VwL0nFdZkXBGdHDUi6NsAEAJ"
          },
          body: JSON.stringify({
            model: mode.model,
            messages: [
              { role: "system", content: mode.description },
              { role: "user", content: prompt }
            ]
          })
        });
        const data = await res.json();
        aiOutput.textContent = data.choices?.[0]?.message?.content || "No reply.";
      } catch (err) {
        console.error(err);
        aiOutput.textContent = "Error talking to AI.";
      }
    };

    generateImageBtn.onclick = async () => {
      generatedImage.src = "";
      const prompt = imagePrompt.value.trim();
      if (!prompt) return alert("Enter a prompt first");

      const selected = JSON.parse(selectModeToUse.value);
      const model = selected?.model || "stabilityai/stable-diffusion-2";

      try {
        const response = await fetch(`https://api-inference.huggingface.co/models/${model}`, {
          method: "POST",
          headers: {
            "Authorization": "Bearer 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",
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ inputs: prompt })
        });

        if (!response.ok) throw new Error("Failed to generate image");

        const blob = await response.blob();
        generatedImage.src = URL.createObjectURL(blob);
      } catch (err) {
        alert("Image generation failed.");
        console.error(err);
      }
    };

    checkAuthAndLoadModes();
  </script></body>
</html>
