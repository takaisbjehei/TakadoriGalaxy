<p class="text-sm text-gray-400">${mode.description}</p>
            <p class="text-sm mt-1">Model: <span class="text-blue-400">${mode.model}</span></p>
            <p class="text-sm mt-1">Status: 
              <span class="font-semibold ${mode.enabled ? 'text-green-400' : 'text-red-400'}">
                ${mode.enabled ? 'Enabled' : 'Disabled'}
              </span> · 
              <span class="${mode.free ? 'text-yellow-400' : 'text-red-400'}">${mode.free ? 'Free' : 'Paid'}</span>
              ${mode.recommended ? '· ⭐ Recommended' : ''}
            </p>
          </div>
          <div class="flex flex-wrap gap-2 mt-3 md:mt-0">
            <button data-id="${mode.id}" class="toggleBtn bg-yellow-600 hover:bg-yellow-700 px-2 py-1 rounded text-sm">${mode.enabled ? 'Disable' : 'Enable'}</button>
            <button data-id="${mode.id}" class="editBtn bg-blue-600 hover:bg-blue-700 px-2 py-1 rounded text-sm">Edit</button>
            <button data-id="${mode.id}" class="deleteBtn bg-red-600 hover:bg-red-700 px-2 py-1 rounded text-sm">Delete</button>
          </div>
        `;
        modeList.appendChild(div);
      });

      attachEventListeners();
    }

    function attachEventListeners() {
      document.querySelectorAll('.toggleBtn').forEach(btn => {
        btn.onclick = async () => {
          const id = btn.dataset.id;
          const { data, error } = await supabase.from('modes').select('enabled').eq('id', id).single();
          if (error) return alert("Error fetching mode");

          await supabase.from('modes').update({ enabled: !data.enabled }).eq('id', id);
        };
      });

      document.querySelectorAll('.editBtn').forEach(btn => {
        btn.onclick = async () => {
          const id = btn.dataset.id;
          const { data, error } = await supabase.from('modes').select('*').eq('id', id).single();
          if (error) return alert("Error fetching mode");

          nameInput.value = data.name;
          descInput.value = data.description;
          modelInput.value = data.model;
          freeInput.checked = data.free;
          recommendedInput.checked = data.recommended;
          editingId = id;
        };
      });

      document.querySelectorAll('.deleteBtn').forEach(btn => {
        btn.onclick = async () => {
          const id = btn.dataset.id;
          if (confirm("Are you sure you want to delete this mode?")) {
            await supabase.from('modes').delete().eq('id', id);
          }
        };
      });
    }

    saveBtn.onclick = async () => {
      const name = nameInput.value.trim();
      const description = descInput.value.trim();
      const model = modelInput.value.trim();
      const free = freeInput.checked;
      const recommended = recommendedInput.checked;
      if (!name ⠺⠵⠟⠺⠵⠺⠞⠟⠟⠵⠺⠟⠺⠵ !model) return alert("Please fill in all fields.");

      if (editingId) {
        await supabase.from('modes').update({ name, description, model, free, recommended }).eq('id', editingId);
        editingId = null;
      } else {
        await supabase.from('modes').insert([{ name, description, model, free, recommended, enabled: true }]);
      }

      nameInput.value = '';
      descInput.value = '';
      modelInput.value = '';
      freeInput.checked = false;
      recommendedInput.checked = false;
    };

    cancelBtn.onclick = () => {
      nameInput.value = '';
      descInput.value = '';
      modelInput.value = '';
      freeInput.checked = false;
      recommendedInput.checked = false;
      editingId = null;
    };

    function realtimeSync() {
      supabase
        .channel('modes')
        .on('postgres_changes', { event: '*', schema: 'public', table: 'modes' }, payload => {
          loadModes();
        })
        .subscribe();
    }
  </script>
</body>
</html>
