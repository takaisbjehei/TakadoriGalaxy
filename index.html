<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TakWebGalaxy Auth</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    .fade-in {
      opacity: 0;
      transform: translateY(40px);
      animation: fadeSlide 0.8s ease forwards;
    }
    @keyframes fadeSlide {
      from { opacity: 0; transform: translateY(40px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center">

  <div id="authBox" class="w-full max-w-md bg-gray-800 rounded-2xl p-8 shadow-xl fade-in space-y-6">
    <h1 class="text-3xl font-bold text-center text-gray-100">TakWebGalaxy</h1>

    <!-- Register -->
    <div id="registerBox">
      <h2 class="text-xl font-semibold text-gray-200 mb-2">Register</h2>
      <input id="regEmail" type="email" placeholder="Email" class="w-full p-2 rounded bg-gray-700 border border-gray-600 mb-2" />
      <input id="regPass" type="password" placeholder="Password" class="w-full p-2 rounded bg-gray-700 border border-gray-600 mb-2" />
      <input id="regConfirm" type="password" placeholder="Confirm Password" class="w-full p-2 rounded bg-gray-700 border border-gray-600 mb-2" />
      <label class="flex items-center text-sm text-gray-400 mb-2">
        <input type="checkbox" id="rememberReg" class="mr-2"> Remember me
      </label>
      <button onclick="register()" class="w-full bg-gray-600 hover:bg-gray-500 text-white py-2 rounded">Register</button>
      <p class="text-sm text-right mt-2 text-gray-400">
        Already have an account? 
        <a href="#" onclick="toggleAuth('login')" class="text-blue-400 hover:underline">Login</a>
      </p>
    </div>

    <!-- Login -->
    <div id="loginBox" class="hidden">
      <h2 class="text-xl font-semibold text-gray-200 mb-2">Login</h2>
      <input id="loginEmail" type="email" placeholder="Email" class="w-full p-2 rounded bg-gray-700 border border-gray-600 mb-2" />
      <input id="loginPass" type="password" placeholder="Password" class="w-full p-2 rounded bg-gray-700 border border-gray-600 mb-2" />
      <label class="flex items-center text-sm text-gray-400 mb-2">
        <input type="checkbox" id="rememberLogin" class="mr-2"> Remember me
      </label>
      <button onclick="login()" class="w-full bg-gray-600 hover:bg-gray-500 text-white py-2 rounded">Login</button>
      <p class="text-sm text-right mt-2 text-gray-400">
        Donâ€™t have an account? 
        <a href="#" onclick="toggleAuth('register')" class="text-blue-400 hover:underline">Register</a>
      </p>
    </div>

    <!-- Google Login (optional setup in Supabase dashboard) -->
    <div class="text-center">
      <button onclick="googleLogin()" class="flex items-center justify-center gap-2 w-full py-2 border border-gray-500 rounded bg-gray-700 hover:bg-gray-600">
        <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google" class="w-5 h-5" />
        <span class="text-sm text-white">Continue with Google</span>
      </button>
    </div>

    <!-- Status + Logout -->
    <div class="text-center pt-4 space-y-2 text-sm">
      <div id="status" class="text-gray-400">Checking login...</div>
      <img id="profilePic" class="w-10 h-10 rounded-full mx-auto hidden" />
      <button onclick="logout()" class="text-red-400 hover:underline text-xs">Logout</button>
    </div>
  </div>

  <script>
    const supabase = window.supabase.createClient(
      'https://yixgzuvrqzmiepobgqmw.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlpeGd6dXZycXptaWVwb2JncW13Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3MzM1NjcsImV4cCI6MjA2NTMwOTU2N30.trP9pVec_3k8W0WJ4epD2NnksQPBIuPcQBTsZrAWyZA'
    );

    window.onload = () => {
      document.getElementById("authBox").classList.add("fade-in");
      checkLoginStatus();
    };

    async function register() {
      const email = document.getElementById("regEmail").value;
      const password = document.getElementById("regPass").value;
      const confirm = document.getElementById("regConfirm").value;
      const remember = document.getElementById("rememberReg").checked;

      if (password !== confirm) {
        alert("Passwords do not match!");
        return;
      }

      const { data, error } = await supabase.auth.signUp({
        email,
        password
      });

      if (error) {
        alert(error.message);
      } else {
        alert("Registered! Please verify your email.");
        window.location.href = "home.html";
      }
    }

    async function login() {
      const email = document.getElementById("loginEmail").value;
      const password = document.getElementById("loginPass").value;
      const remember = document.getElementById("rememberLogin").checked;

      const { data, error } = await supabase.auth.signInWithPassword({
        email,
        password
      });

      if (error) {
        alert(error.message);
      } else {
        window.location.href = "home.html";
      }
    }

    async function googleLogin() {
      const { error } = await supabase.auth.signInWithOAuth({
        provider: 'google'
      });

      if (error) {
        alert("Google login failed: " + error.message);
      }
    }

    async function logout() {
      await supabase.auth.signOut();
      alert("Logged out");
      location.reload();
    }

    async function checkLoginStatus() {
      const { data: { user } } = await supabase.auth.getUser();
      const status = document.getElementById("status");
      const profilePic = document.getElementById("profilePic");

      if (user) {
        status.textContent = `Logged in as: ${user.email}`;
        profilePic.classList.add("hidden"); // no photo yet from Supabase
      } else {
        status.textContent = "Not logged in";
        profilePic.classList.add("hidden");
      }
    }

    function toggleAuth(mode) {
      document.getElementById("registerBox").classList.toggle("hidden", mode !== "register");
      document.getElementById("loginBox").classList.toggle("hidden", mode !== "login");
    }
  </script>
</body>
</html>
